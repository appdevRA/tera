{% load static %}

{% block headerinclude %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Collections</title>
  <link rel="shortcut icon" href="{% static 'images/logo.png' %}">
   <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    
    <!-- <link rel="stylesheet" href="{% static 'css/navbarstyle.css' %}"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/abb9521de4.js" crossorigin="anonymous"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script> -->
     
     
    <style>
table {
  border-spacing: 2;
  width: 100%;
  border: 0px solid #ddd;
}

th, td {
  text-align: left;
  padding: 16px;
}

/*tr:nth-child(even) {
  background-color: #f2f2f2

}*/
tr:hover {
  background-color: #c4c4c4

}

+.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 100%;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}


.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown a:hover {background-color: #ddd;}

.show {display: block;}

.folder_dropdown_style{
  padding-left: 20%
}

</style>
</head>
{% endblock headerinclude %}


<body style="background-color: #f3f3f3">
   <nav >
      <div class="logo"><a href="{% url 'ra:index_view'%}"><img class="logo-style" src="{% static 'images/logo.png' %}"></a></div>
      
      <ul>     
      <li id="myAccount">   

                
                <a href="#" style="color: #8f2929">My Account <i class="fa fa-user" aria-hidden="true"></i></a>
                
                <ul style="z-index: 1">
                <li><a href="{% url 'ra:search_result_view' %}">Search</a></li>  
                  <li><a href="{% url 'ra:tera_account_settings' %}">Settings</a></li>  
                  <li><a href="{% url 'ra:tera_logout_view' %}">Logout</a></li>  
                </li>
                </ul>
      </li>

        </ul>
<!-- Add Folder Modal -->
                  <div class="modal fade" id="addtoFolderModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header text-center">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"  style=“color: yellow”; >
                          <span aria-hidden="true">&times;</span>
                        </button>
                        <div class="modal-body mx-3">
                        <div class="md-form mb-5">
                      
                         <center> 
                       
                          {% csrf_token %}
                            <p style="font-size: 25px; color: #800000">Create Folder</p>
                            
                            
                            
                            <input type="text" placeholder="Enter Collection Name" style="width: 80%" id="foldername_input" value="My collection" required><br>
                            <a id="add_folder_error" style="color: red; visibility: hidden">Folder name already exist</a>
                           <br><br><br>
                       
                   
                        <center>
                              <div class="form-row">
                                <div class="form-group col-md-6">
                                <button id="dismiss-modal_folder" type=“button” class="buttoncancel" data-dismiss="modal" onclick="hide_errorMessage()">Cancel</button>
                                </div>
                             
                                <div class="form-group col-md-6"> 
                                    <button type="submit" name="buttonLogin"class="buttonlogout"   onclick="create_folder('folders')"> Create</button>
                                </div> 
                         </div>
                      </center>
                      
                      </center>
                    </div></div>
                      </div>
                      
                  </div>
                </div>
                </div>

<!-- Collab Modal -->
                  <div class="modal fade" id="addtoGroupModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header text-center">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"  style=“color: yellow”; >
                          <span aria-hidden="true">&times;</span>
                        </button>
                        <div class="modal-body mx-3">
                        <div class="md-form mb-5">
                      
                         <center> 
                       
                       
                            <p style="font-size: 25px; color: #800000">Create Group</p>
                            
                            
                            
                            <input type="text" placeholder="Enter Collection Name" style="width: 80%" id="groupname_input" value="My group" required>
                           <br>
                            <a id="add_group_error" style="color: red; visibility: hidden">Group name already exist</a>
                           <br><br><br>

                   
                        <center>
                              <div class="form-row">
                                <div class="form-group col-md-6">
                               <button id="dismiss-modal_group" type=“button” class="buttoncancel" data-dismiss="modal" onclick="hide_errorMessage()">Cancel</button>
                                </div>
                                
                                <div class="form-group col-md-6"> 
                                    <button type="submit" name="buttonLogin"class="buttonlogout"   onclick="create_folder('groups')"> Create</button>
                                </div> 
                         </div>
                      </center>
                      
                      </center>
                    </div></div>
                      
                      </div>
                    </div>

                  </div>
                  </div>  

                  <!-- Add Member Modal -->
                  <div class="modal fade" id="addMemberModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header text-center">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"  style=“color: yellow”; >
                          <span aria-hidden="true">&times;</span>
                        </button>
                        <div class="modal-body mx-3">
                        <div class="md-form mb-5">
                      
                         <center> 
                       
                          {% csrf_token %}
                            <p style="font-size: 25px; color: #800000">Enter username</p>
                            
                            
                            <input type="text" placeholder="18-5126-269" style="width: 80%" id="idNumber_input" value="" required><br>
                          <center>
                            <a id="error_message" style="color: red; "></a>
                            
                          </center>
                           <br><br><br>
                       
                   
                        <center>
                              <div class="form-row">
                                <div class="form-group col-md-6">
                                <button id="dismiss-modal_member" type=“button” class="buttoncancel" data-dismiss="modal" onclick="hide_errorMessage()">Cancel</button>
                                </div>
                              
                                <div class="form-group col-md-6"> 
                                    <button id="add_member" type="submit" name="buttonLogin"class="buttonlogout"  > Add</button>
                                </div> 
                         </div>
                      </center>
                      
                      </center>
                    </div></div>
                      </div>
                      
                  </div>
                </div>
                </div>
    
  </nav>


  <div class="container-fluid" style="position: fixed">
  <div class="row">
    <div class="col-sm-2">
      <div class="main-menu" style="border-right:2px #800000 solid;">
        <ul>
            <section class="home">
                <li id="all" class="menu-item" onclick="get_bookmarks(this.id)" ><i id="allIcon" class="fa fa-bookmark"></i> &nbsp; &nbsp; &nbsp; &nbsp;My Collections</li>
                <li id="recentlyAdded" class="menu-item" onclick="get_bookmarks(this.id, false)" ><i id="recentlyAddedIcon" class="fa fa-history"></i>&nbsp; &nbsp;&nbsp; &nbsp; Recently Added</li>
                <li id="recentlyRead" class="menu-item" onclick="get_bookmarks(this.id, false)" ><i id="recentlyReadIcon" class="fa fa-bookmark"></i>&nbsp; &nbsp;&nbsp; &nbsp; Recently Read</li>
                <li id="favorite" class="menu-item" onclick="get_bookmarks(this.id, false)" ><i id="favoriteIcon" class="fa fa-star"></i>&nbsp; &nbsp; &nbsp; &nbsp;Favorites</li>
                <li id="trash" class="menu-item" onclick="get_bookmarks(this.id, false)"><i id="trashIcon" class="fa fa-trash" ></i>&nbsp; &nbsp; &nbsp; &nbsp;Trash</li>



                <li id="collections" class="collapsible menu-item" onclick="display_dropdown('folders')"><i class="fa fa-folder"></i>&nbsp; &nbsp;&nbsp; &nbsp;  <b >My Folders </b> <button  style="font-size: 140%;border: solid #f1f1f1; color: red; font-weight:bold; margin-left: 17%" name="addfolder" href="#addtoFolderModal" data-toggle='modal' data-target='#addtoFolderModal'>  +</button></li> 
                
                    <ul id="mycollection_ul" style="display: none">
                      
                    </ul>
                               
                <li id="groups" class="collapsible menu-item" onclick="display_dropdown('groups')"><i class="fa fa-group"></i>&nbsp; &nbsp;&nbsp; &nbsp;  <b>Private Groups </b> <button  style="font-size: 140%;border: solid #f1f1f1; color: red; font-weight:bold; margin-left: 16%" name="addgroup" href="#addtoFoldaddtoGroupModalerModal" data-toggle='modal' data-target='#addtoGroupModal'> + </button></li> 
                
                    <ul id="mygroup_ul" style="display: none">
                      
                    </ul>
              <div>
                  
                </div>
                
                <!-- </li> -->
               </section>             
        </ul>
      </div>
    </div>

    <div class="col-sm-7" style="border-right: solid #800000 2px;   overflow-y: scroll;  height: 90vh">
      <div class="wrapper">
       <div class="main_content">
          <div class="header" >
          <!--  <i  onclick="add_folder_button()" class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>
           <center>
                         <div id="dropdown-content_input" class='dropdown-content' style='min-width: 20%; margin-left: 5%; margin-top: -1%; z-index: 5 '>
                         <ul id='add_folder_fillup_ul'>
                     <br>
                             <input type="text" name="foldername_input"> <input type="button" name="" value="add">
                             
                          </ul> </div></center> -->
                  
                <br> 
              
                   <table id="itemTable"  class="table">
                    <col width="11%" />
                    <col width="8%" />
                    <col width="36%" />
                    <col width="15%" />


                    <thead>
                      
                        <th >Site</th>
                        <th onclick="sort(1)" style="cursor: pointer">Type</th>
                        <th  style="cursor: pointer;">Title</th>
                        <th onclick="sort(3)"style="cursor: pointer">Date Added</th>
                        <th onclick="sort(4)"style="cursor: pointer">Date Accessed</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        
                    </thead>
                    <tbody id="itemArea">
                      <td></td>
                        <td><a href='' target='_blank'><span  class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' onclick='open_link()'></span></a></td>

                        <td></td>
                        <td class='dateAccessed'></td>
                        <td id='' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>


                         <td><i   class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>
                         <div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>
                         <ul id='add_to_folderList_ul"+i+"'>
                     
                              
                          "</ul> </div> </td>




                         
                        <td id='"+markers[i].id+"' class='trash'> </td>
                       
                    </tbody>
                  </table>
                </div>

            </div>
            
                 
        </div>
        <br>
        <br>
        <br>
        <br>
        <div id="recommendation">
              <h4>Recommended For You</h4>
              <div class="wrapper">
              <div class="main_content">
              <div class="header" >
              <br>

              <table id="recommendationTable" class="table">
              <thead>

              <th >Site</th>
              <th >Item type</th>
              <th >Title</th>
              <th ></th>
              <th ></th>
              <th ></th>
              <th ></th>
              <th ></th>

              <tbody id="recommendationArea">
              </thead>
              {% for item in recommendation %}
              <tr>
              {% if item.websiteTitle == "Springeropen" %}
              <td><img class='logo-style' src="{% static 'images/springerLogo.PNG' %}" style='height: 15px;'></td>"
              {% endif %} 
              <td>{{item.itemType}}</td>
              <td> <a id = "recommendation{{item.id}}" style="max-width: 40ch; white-space: nowrap;overflow: hidden;text-overflow: ellipsis;" href="{{item.url}}" target='_blank'> {{item.title}} </a> </td>

              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td id="addRecommended{{item.id}}" class="bookmark_recommended"style="cursor: pointer;"><i class='fa fa-bookmark' style="color:red" ></i></td>

              </tr>
              {% endfor %}
              </tbody>
              </table>
              </div>
              </div>
              </div>
        </div>
        </div>

        


    <div class="col-sm-3" style="overflow-x: scroll;  overflow-y: scroll;  height: 90vh">
      <br>
      <h4>Details</h4>
     <table id="detailTable" class="table" style="overflow: none;" >
       <thead>
        <tr>
         <th></th>
         <th></th>
         </tr>

       </thead>

       <tbody id="detailArea" style="overflow: none;">

       </tbody>
 
     </table>
   <ul id='group_detail_ul' style='margin-left: 10%; '></ul>
    </div>
  
</div>

</div>
    
    
</body>


<script type="text/javascript">
   var markers= {{bookmark_list | safe}}

   var folders = []
  
   var groups = []
    tab = 'all'
    // var folders
    var bookmark_folder
    var faction_id = 1
    var faction_markers
    var group_id

$(document).ready(function($) {
  
  get_bookmarks('all', 0,true)



        var coll = document.getElementsByClassName("collapsible");

          for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
              this.classList.toggle("active");

              var content = this.closest(".menu-item").nextElementSibling;
              if (content.style.display == "block") {
                content.style.display = "none";
              } else {
                content.style.display = "block";
              }
            });
          }


          // Close the dropdown if the user clicks outside of it
          window.onclick = function(event) {
            if (!event.target.matches('.fa-plus')) {
              var dropdowns = document.getElementsByClassName("dropdown-content");
              
              for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                  openDropdown.classList.remove('show');
                }
              }
            }
          }
      

});





function get_bookmarks(tab_name, folder_id, isGet){
    

        if(isGet){
          showRows(tab_name, markers, folder_id, true)

          if(tab_name != "folders" & tab_name != "groups"){
              document.getElementById(tab_name).style.backgroundColor= "#c9c9c9";
              document.getElementById(tab_name).style.color= "#800000";
              document.getElementById(tab_name+'Icon').style.color= "#800000";
          }else{
              document.getElementById(folder_id).style.backgroundColor= "#c9c9c9";
              document.getElementById(folder_id).style.color= "#800000";
          }
          
        }
    
        else{
          $("#detailArea").empty();
          clearStyle();
          $("#itemArea").empty();
          
          if(tab_name.includes("folder")){
              tab = "folders"
              folder_id = tab_name.slice(6,)
              faction_id = folder_id
              document.getElementById(tab_name).style.backgroundColor= "#c9c9c9";
              document.getElementById(tab_name).style.color= "#800000";
          }else if(tab_name.includes("groups")){
              tab = "groups"
              folder_id = tab_name.slice(6,)
              faction_id = folder_id
              document.getElementById(tab_name).style.backgroundColor= "#c9c9c9";
              document.getElementById(tab_name).style.color= "#800000";
                
          }else{
              tab = tab_name
              folder_id = ""
              document.getElementById(tab_name).style.backgroundColor= "#c9c9c9";
              document.getElementById(tab_name).style.color= "#800000";
              document.getElementById(tab_name+'Icon').style.color= "#800000";
          }
                $.ajax({
                        type:"POST",
                        url:"",

                        data:{
                          action: 'get_bookmarks',
                          tab: tab,
                          faction_id: folder_id,
                          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                        }, success: function(response){

                           markers = response.bookmarks
                           
                            if(tab_name.includes("folder") | tab_name.includes("groups")){

                                if(tab_name.includes("groups")){
                                      members = response.member
                                      $("#group_detail_ul").empty();
   
                                      for(i=0;i< groups.length;i++){
                                        if(groups[i].id == folder_id){
                                           date = new Date(groups[i].date_created)
                                         $('#group_detail_ul').append("<br><div><b>Group name:</b> &nbsp; "+groups[i].name+"</div> "+
                                          // "<br><div><b>Description:</b>&nbsp; "+group[0]['description']+"</div>" +
                                          "<br><div><b>Owner:</b> &nbsp; "+groups[i].ownerName +"</div>" + 
                                          "<br><div><b>Date created:</b>  &nbsp;"+ date.toDateString().slice(3,)+" "+date.toTimeString().slice(0,5)+"</div>" + 
                                          "<br><div style='margin-left:-5%'><i class='fas fa-user-plus' style='font-size:90%; cursor:pointer;' href='#addMemberModal' data-toggle='modal' data-target='#addMemberModal'></i> &nbsp; <b>Member(s)</b>: </div>"
                                        ); 

                                        }
                                      }
                                       console.log(members)
                                        for(i=0;i<members.length;i++){
                                            $('#group_detail_ul').append(
                                                      "<div class='member' style='margin-left:25%'> "+ members[i].first_name+" "+ members[i].last_name +" </div>"  
                                                      );
                                          }
                               
                                  }
                              showRows(tab, markers, tab_name)
                            }
                            else
                              showRows(tab, markers)

                        }, error: function(response){
                          alert("Something went, bookmarks in this tab cannot be retrieved")
                        }

                       
                }); 
        }
      
}
function showRows(rowType, markers, folder_id, isRefresh){
   document.getElementById("recommendation").style.display = "none"

    if(isRefresh == true){
      clearStyle();
      $("#itemArea").empty();
    }
    
    if(rowType == 'all'){
      $("#group_detail_ul").empty();
      // document.getElementById(rowType).style.backgroundColor= "#c9c9c9";
      // document.getElementById(rowType).style.color= "#800000";
      // document.getElementById('allIcon').style.color= "#800000";

            for(i=0; i< markers.length;i++){
             

                if( markers[i].isRemoved == 0 ){

                      sitelogo=""
                      date_add= new Date(markers[i].dateAdded)
                      
                      date_acc= new Date(markers[i].dateAccessed)

                      if( markers[i].isFavorite == 0){
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"' class='far fa-star' style='cursor: pointer' ></i></td>"
                      }else{
                        favorite ="<td class='favorite'><i id='"+i+"|" + markers[i].id+"' class='fas fa-star' style='cursor: pointer; color:red' ></i></td>"
                      }
                      if(markers[i].bookmark__websiteTitle == "Springeropen"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
                      } 
                      

                       $('#itemArea').append(
                        "<tr>"+
                        sitelogo +
                        "<td style='overflow: hidden;text-overflow: ellipsis; max-width: 50ch;text-align: justify;' >"+ markers[i].bookmark__itemType +  "</td>"+
                        "<td><a href='"+ markers[i].bookmark__url+ "' target='_blank'><span id="+ markers[i].id +" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' onclick='open_link()'>" + markers[i].bookmark__title +  "</span></a></td>"+

                        "<td>" + date_add.toDateString().slice(3,)+" "+date_add.toTimeString().slice(0,5) + "</td>" +
                        "<td class='dateAccessed'>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +
                        "<td id="+ markers[i].bookmark__id +" class='get_detail'><i id='"+ markers[i].id +"' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>" +


                         "<td><i  onclick='getFolders("+ i + ","+ markers[i].id+")' class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>" +
                         "<div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>"+
                         "<ul id='add_to_folderList_ul"+i+"'>"+
                     
                              
                          "</ul> </div> </td>" +




                          favorite+
                        "<td id='"+markers[i].id+"' class='trash'> <i class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'></i></td>" +
                       

                       "</tr>"

                        );  
                }  
                 
            }
            document.getElementById("recommendation").style.display = "inline"

    } else if(rowType =='trash'){
      $("#group_detail_ul").empty();
      // document.getElementById(rowType).style.backgroundColor= "#c9c9c9";
      // document.getElementById(rowType).style.color= "#800000";
      // document.getElementById('trashIcon').style.color= "#800000";

        for(i=0; i< markers.length;i++){

            if( markers[i].isRemoved == 1){
                date_acc= new Date(markers[i].dateAccessed)
                date_removed= new Date(markers[i].date_removed)
              if(markers[i].bookmark__websiteTitle == "Springeropen"){
                sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
              } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
              } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
              } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
              } 
         

              $('#itemArea').append(
                "<tr >" +

                sitelogo+
                "<td>"+ markers[i].bookmark__itemType +  "</td>"+

                "<td><a  target='_blank'><span id="+ markers[i].id +" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' >"+ markers[i].bookmark__title +  "</span></a></td>"+

                "<td>" +  date_removed.toDateString().slice(3,)+" "+date_removed.toTimeString().slice(0,5)  + "</td>" +
               "<td>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +

                "<td class='untrash'  id='"+ markers[i].id+"'> <i id='"+ markers[i].id+"' class='fas fa-undo' style='cursor: pointer'></i></td>" +
                "<td class='delete' id='"+ markers[i].id+"' > <i id='"+ markers[i].bookmark__id+"' class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'></i></td>" +

              
                      

                        



               "</tr>"

                );  
                
              
            }


         
        }

      
    } else if(rowType =='recentlyAdded'){
          $("#group_detail_ul").empty();
          // document.getElementById(rowType).style.backgroundColor= "#c9c9c9";
          // document.getElementById(rowType).style.color= "#800000";
          // document.getElementById('recentlyAddedIcon').style.color= "#800000";

           // month is zero based
          now  = new Date;               // no arguments -> current date
          
        
          for(i=0; i< markers.length;i++){
              var then = new Date(markers[i].dateAdded),
              days = Math.round((now - then) / (1000 * 60 * 60 * 24));
                if( markers[i].isRemoved == 0 & days <= 7){
                   

                      date_add= new Date(markers[i].dateAdded)

                        date_acc= new Date(markers[i].dateAccessed)

                      if( markers[i].isFavorite == 0){
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"' class='far fa-star' style='cursor: pointer' ></i></td>"
                      }else{
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"' class='fas fa-star' style='cursor: pointer; color:red' ></i></td>"
                      }

                      if(markers[i].bookmark__websiteTitle == "Springeropen"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
                      } 
                       $('#itemArea').append(
                        "<tr>"+
                        sitelogo +
                        "<td>"+ markers[i].bookmark__itemType +  "</td>"+
                        "<td><a href='"+ markers[i].bookmark__url+ "' target='_blank'><span id="+ markers[i].id +" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' >" + markers[i].bookmark__title +  "</span></a></td>"+

                        "<td>" + date_add.toDateString().slice(3,)+" "+date_add.toTimeString().slice(0,5) + "</td>" +
                        "<td>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +
                        "<td id="+ markers[i].bookmark__id +" class='get_detail'><i id='"+ markers[i].id +"' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>" +


                         "<td><i  onclick='getFolders("+ i + ","+ markers[i].id+")' class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>" +
                         "<div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>"+
                         "<ul id='add_to_folderList_ul"+i+"'>"+
                     
                              
                          "</ul> </div> </td>" +




                          favorite+
                        "<td id='"+markers[i].id+"' class='trash'><i id='"+ markers[i].id+"' class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'  ></i></td>" +
                       

                       "</tr>"

                        );  
                }  
         
          }
    } else if(rowType =='recentlyRead'){
          $("#group_detail_ul").empty();
          // document.getElementById(rowType).style.backgroundColor= "#c9c9c9";
          // document.getElementById(rowType).style.color= "#800000";
          // document.getElementById('recentlyReadIcon').style.color= "#800000";
          now  = new Date;
          for(i=0; i< markers.length;i++){
                var then = new Date(markers[i].dateAccessed), // month is zero based
                               // no arguments -> current date
                days = Math.round((now - then) / (1000 * 60 * 60 * 24));
               
                if( markers[i].isRemoved == 0 & days <= 3){

                        date_add= new Date(markers[i].dateAdded)

                        date_acc= new Date(markers[i].dateAccessed)

                      if( markers[i].isFavorite == 0){
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"' class='far fa-star' style='cursor: pointer' ></i></td>"
                      }else{
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"' class='fas fa-star' style='cursor: pointer; color:red' ></i></td>"
                      }

                      if(markers[i].bookmark__websiteTitle == "Springeropen"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
                      } 

                       $('#itemArea').append(
                        "<tr>"+
                        sitelogo +
                        "<td>"+ markers[i].bookmark__itemType +  "</td>"+
                        "<td><a href='"+ markers[i].bookmark__url+ "' target='_blank'><span id="+ markers[i].id +" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' >" + markers[i].bookmark__title +  "</span></a></td>"+

                        "<td>" + date_add.toDateString().slice(3,)+" "+date_add.toTimeString().slice(0,5) + "</td>" +
                        "<td>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +
                        "<td id="+ markers[i].bookmark__id +" class='get_detail'><i id='"+ markers[i].id +"' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>" +


                         "<td><i  onclick='getFolders("+ i + ","+ markers[i].id+")' class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>" +
                         "<div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>"+
                         "<ul id='add_to_folderList_ul"+i+"'>"+
                     
                              
                          "</ul> </div> </td>" +




                          favorite+
                        "<td id='"+markers[i].id+"' class='trash'><i id='"+ markers[i].id+"' class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'  ></i></td>" +
                       

                       "</tr>"

                        );  
                }  
         
          }

    } else if(rowType =='favorite'){
          $("#group_detail_ul").empty();
          // document.getElementById(rowType).style.backgroundColor= "#c9c9c9";
          // document.getElementById(rowType).style.color= "#800000";
          // document.getElementById('favoriteIcon').style.color= "#800000";
          for(i=0; i< markers.length;i++){
            
            if( markers[i].isFavorite == 1 & markers[i].isRemoved == 0){
                   date_add= new Date(markers[i].dateAdded)
                      date_acc= new Date(markers[i].dateAccessed)
                   

                    if(markers[i].bookmark__websiteTitle == "Springeropen"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
                      } 
              $('#itemArea').append(
                "<tr>"+
                sitelogo +
                "<td>"+ markers[i].bookmark__itemType +  "</td>"+
                "<td><a href='"+ markers[i].bookmark__url+ "' target='_blank'><span id="+ markers[i].id +" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' >" + markers[i].bookmark__title +  "</span></a></td>"+

               "<td>" + date_add.toDateString().slice(3,)+" "+date_add.toTimeString().slice(0,5) + "</td>" +
                        "<td>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +
              "<td id="+ markers[i].bookmark__id +" class='get_detail'><i id='"+ markers[i].id +"' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>" +
                           
                          "<td><i  onclick='getFolders("+ i + ","+ markers[i].id+")' class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>" +
                         "<div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>"+
                         "<ul id='add_to_folderList_ul"+i+"'>"+
                     
                              
                          "</ul> </div> </td>" +

                          "<td class='favorite'><i id='"+i+"|" +markers[i].id+"' class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'  ></i></td>" +
               "</tr>"


                );  

            }
         
        }
    } else if(rowType =='folders'){

        $("#group_detail_ul").empty();
       
        // document.getElementById('allIcon').style.color= "#800000";
        for(i=0;i < markers.length;i++){
        
                  date_add= new Date(markers[i].dateAdded)
                  
                  date_acc= new Date(markers[i].dateAccessed)

                      sitelogo=""
                      if( markers[i].isFavorite == false | markers[i].isFavorite == 0){
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"|" +folder_id+"' class='far fa-star' style='cursor: pointer' ></i></td>"
                      }else{
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"|" +folder_id+"' class='fas fa-star' style='cursor: pointer; color:red' ></i></td>"
                      }
                      if(markers[i].bookmark__websiteTitle == "Springeropen"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
                      } 
                       $('#itemArea').append(
                        "<tr>"+
                        sitelogo +
                        "<td>"+ markers[i].bookmark__itemType +  "</td>"+
                       "<td><a href='"+ markers[i].bookmark__url+ "' target='_blank'><span id="+ markers[i].id +"|"+folder_id+" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;' >" + markers[i].bookmark__title +  "</span></a></td>"+

                        "<td>" + date_add.toDateString().slice(3,)+" "+date_add.toTimeString().slice(0,5) + "</td>" +
                        "<td class='dateAccessed'>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +
                        "<td id="+ markers[i].bookmark__id +" class='get_detail'><i id='"+ markers[i].id +"' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>" +


                         "<td><i  onclick='getFolders("+ i + ","+ markers[i].id+")' class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>" +
                         "<div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>"+
                         "<ul id='add_to_folderList_ul"+i+"'>"+
                     
                              
                          "</ul> </div> </td>" +
                          favorite+




                        "<td id='"+folder_id+"|"+markers[i].id+"' class='trash'><i id='"+ markers[i].id+"' class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'></i></td>" +
                       

                       "</tr>"

                        );   
                
        
        
      }
    } else if(rowType =='groups'){
      // group_id = faction_id
     
      for(i=0;i < markers.length;i++){

                  date_add= new Date(markers[i].dateAdded)
                    
                        date_acc= new Date(markers[i].dateAccessed)
                        sitlogo=""
                      if( markers[i].isFavorite == 0){

                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"|" +folder_id+"' class='far fa-star' style='cursor: pointer' ></i></td>"
                      }else{
                        favorite ="<td class='favorite'><i id='"+i+"|" +markers[i].id+"|" +folder_id+"' class='fas fa-star' style='cursor: pointer; color:red' ></i></td>"
                      }

                      if(markers[i].bookmark__websiteTitle == "Springeropen"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/springerLogo.PNG' %}' style='height: 15px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "UNESCO Digital Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/unescoLogo.PNG' %}' style='height: 18px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "Open Textbook Library"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/otlLogo.PNG' %}' style='height: 14px;'></td>"
                      } else if(markers[i].bookmark__websiteTitle == "OER Commons"){
                        sitelogo =  "<td><img class='logo-style' src='{% static 'images/oerLogo.PNG' %}' style='height: 17px;'></td>"
                      } 
                       $('#itemArea').append(
                        "<tr>"+
                        sitelogo +
                        "<td>"+ markers[i].bookmark__itemType +  "</td>"+
                       "<td><a href='"+ markers[i].bookmark__url+ "' target='_blank'><span id="+ markers[i].id +"|"+folder_id+" class='open_link' style='display:inline-block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-width: 40ch;'>" + markers[i].bookmark__title +  "</span></a></td>"+

                        "<td>" + date_add.toDateString().slice(3,)+" "+date_add.toTimeString().slice(0,5) + "</td>" +
                        "<td class='dateAccessed'>" + date_acc.toDateString().slice(3,)+" "+date_acc.toTimeString().slice(0,5) + "</td>" +
                        "<td id="+ markers[i].bookmark__id +" class='get_detail'><i id='"+ markers[i].id +"' class='fas fa-info-circle fa-lg' style='cursor: pointer' ></i></td>" +


                         // "<td><i  onclick='bookmarkToFolder_dropdown("+ i + ","+ array[i].id+")' class='fa fa-plus' style='cursor:pointer; font-size: 80%'></i>" +
                         "<div id='folderList_dropdown"+i+"' class='dropdown-content' style='min-width: 15%; margin-left: -8% '>"+
                         "<ul id='add_to_folderList_ul"+i+"'>"+
                     
                              
                          "</ul> </div> </td>" +
                          favorite+




                        "<td id='"+folder_id+"|"+markers[i].id+"' class='trash'> <i id='' class='fas fa-trash' style='color:#a71f1f;cursor: pointer; font-size: 90%'></i></td>" +
                       

                       "</tr>"

                        );   
                
        
        
      }
      
    }


}

$(document).on("click", ".bookmark_recommended", function(){
    id = $(this).attr("id").replace("addRecommended","")
    selectedRow = $(this).parents("tr")
    $.ajax({
              type:"POST",
              url:"",

              data:{
                action: 'add_recommended',
                detailID: id,
                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()

              },
              success: function(response){
                markers.push(response.addedBookmark[0])
                
                $("#recommendationArea").append(selectedRow)
                selectedRow.remove()
                get_bookmarks("all", 0,true)
              }
    }); 
})
$(document).on("click", ".delete", function(){
     
      didConfirm = confirm("Do you really want to delete this bookmark?")

      if(didConfirm){

          selectedRow = $(this).parents("tr")
          id = $(this).attr("id")
        $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        action: 'deleteItem',
                        bID: id,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      },
                      success: function(response){
                          selectedRow.remove()
                        
                        
                      },
                      error: function(response){
                        alert("Something went, bookmark cannot be restored")
                      }
        }); 
      }
})


$(document).on("click", ".untrash", function(){
      selectedRow = $(this).parents("tr")

      id = $(this).attr("id")
        $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        action: 'unTrashItem',
                        bID: id,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      },
                      success: function(response){
                          selectedRow.remove()
                        
                        
                      },
                      error: function(response){
                        alert("Something went, bookmark cannot be restored")
                      }
        }); 
      // }

})
$(document).on("click", ".trash", function(){
        if(tab == "favorite")
            didConfirm = true
        else
            didConfirm = confirm("Do you really want to trash this bookmark?")
        
        if(didConfirm){
          selectedRow = $(this).parents("tr")
          id = $(this).attr("id")
          action = "trashItem"

            if(tab == "folders" | tab == "groups"){
                folder_id = id.split("|")[0].replace("folder","").replace("groups","")
                bookmark_id = id.split("|")[1]
            }else if(tab == "favorite"){
                action = "remFav"
                bookmark_id = id
            } else{
              bookmark_id = id
              folder_id = ""
            }

                $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        action: action,
                        tab: tab,
                        faction_id: folder_id
                        ,
                        b_id: bookmark_id,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      }, 

                      success: function(response){
                          selectedRow.remove()
                        
                        
                      },
                      error: function(response){
                        alert("Something went, bookmark cannot be deleted")
                      }
                      

                }); 
     
        }
            
});


$(document).on("click", ".favorite", function(){

      rowID = $(this).children().attr("id")
      i = rowID.split("|")[0] //row index
      clicked_id = rowID.split("|")[1] //bookmark id
      group_id = ""
      // for(i=0; i< markers.length;i++){
      // if(markers[i].bookmark__id == clicked_id){
        if(markers[i].isFavorite == 0){
          markers[i].isFavorite = true;  
          // clearRow('itemArea')
          if(tab=='folders'){

            markers[i].isFavorite = true
            get_bookmarks(tab, rowID.split("|")[2],true)

          }else if(tab=='groups'){
            markers[i].isFavorite = true
            get_bookmarks(tab, rowID.split("|")[2],true)
            group_id = rowID.split("|")[2].replace("groups","")
          }else{
            get_bookmarks(tab,0,true)

          } 
              $.ajax({
                          type:"POST",
                          url:"",

                          data:{
                            action: 'addFav',
                            tab: tab,
                            b_id: clicked_id,
                            group_id: group_id,
                            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                          }
              }); 

        } else if(markers[i].isFavorite == 1){
          markers[i].isFavorite = 0;  
           if(tab=='folders'){
            markers[i].isFavorite = false
            get_bookmarks(tab, rowID.split("|")[2],true)
            
          } else if(tab=='groups'){
            markers[i].isFavorite = false
            get_bookmarks(tab, rowID.split("|")[2],true)
            group_id = rowID.split("|")[2].replace("groups","")
          }else{
            get_bookmarks(tab, 0,true)
          } 
            $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        tab: tab,
                        action: 'remFav',
                        b_id: clicked_id,
                        group_id: group_id,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      }
        }); 
            
        }
        
       
    
        });


$(document).on("click", ".open_link", function(){
  date = new Date()
  $(this).parents("td").siblings(".dateAccessed").html(date.toDateString().slice(3,)+" "+date.toTimeString().slice(0,5))
  
  if( tab != "folders" & tab != "groups"){
    bookmark_id = $(this).attr("id")
    faction_id = ""
  } else{
    bookmark_id = $(this).attr("id").split("|")[0]
    faction_id = $(this).attr("id").split("|")[1].replace("folder","").replace("groups","")
  }
 

        $.ajax({
            type:"POST",
            url:"",

            data:{
              action: 'open_link',
              tab: tab,
              bID: bookmark_id,
              faction_id: faction_id,
              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
            }
        }); 

})

$(document).on("click", ".get_detail", function(){
    detailID = $(this).attr("id")


        $.ajax({
            type:"POST",
            url:"",

            data:{
              action: 'get_detail',
              detailID: detailID,
              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
            },  success: function(response){
                 $("#detailArea").empty();

                detail = response.detail

                  var added = new Date( detail[0].dateAdded);
                  var accessed = new Date( detail[0].dateAccessed);
                    $('#detailArea').append("<tr ><td style='text-align: right; vertical-align:top'> Website: </td>"+ "<td> <a href='https://"+detail[0].websiteTitle+ "'>"+ detail[0].websiteTitle +  "</a></td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Item type: </td>"+ "<td>"+ detail[0].itemType +  "</td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> URL: </td>"+ "<td><a href='"+detail[0].url+"' target='_blank'>"+ detail[0].url +  "</td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Title: </td>"+ "<td>"+ detail[0].title +  "</td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Author: </td>"+ "<td>"+ detail[0].author +  "</td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Abstract: </td>"+ "<td>"+ detail[0].description +  "</td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Collection: </td>"+ "<td>"+ detail[0].journalItBelongs +  "</td></tr>" );  
                    $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Publication Year: </td>"+ "<td>"+ detail[0].publicationYear +  "</td></tr>" );  
                    $('#detailArea').append(
                     "<tr><td style='text-align: right; vertical-align:top'> Publisher: </td>"+ "<td>"+ detail[0].publisher +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> Volume: </td>"+ "<td>"+ detail[0].volume +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> Edition: </td>"+ "<td>"+ detail[0].edition +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> Citation: </td>"+ "<td>"+ detail[0].numOfCitation +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> Downloads: </td>"+ "<td>"+ detail[0].numOfDownload +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> Pages: </td>"+ "<td>"+ detail[0].numOfPages +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> DOI: </td>"+ "<td>"+ detail[0].DOI +  "</td></tr>" +
                     "<tr><td style='text-align: right; vertical-align:top'> ISSN: </td>"+ "<td>"+ detail[0].ISSN +  "</td></tr>" 
                     
           
             
             
                     );  
                }
        }); 
  

})

$(document).on("click", "#add_member", function(){
      username = document.getElementById('idNumber_input').value
        $.ajax({
              type:"POST",
              url:"",

              data:{
                action: 'add_member',
                id: username,
                gID: faction_id,
                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
              }, 

              success: function(response){
                result = response.result
                
                if(result == 'member'){
                  document.getElementById('error_message').style.display = "inline"
                  document.getElementById('error_message').innerHTML ="User is already a member"

                }
                else if(result == 'owner'){
                   document.getElementById('error_message').style.display = "inline"
                  document.getElementById('error_message').innerHTML ="User is the owner"
                }
                 
                else if(result == 'not exist'){
                  document.getElementById('error_message').style.display = "inline"
                  document.getElementById('error_message').innerHTML ="User does not exist"
                  
                }
                else if(result == 'added'){
                  member = response.member
                  document.getElementById('dismiss-modal_member').click()
                  alert("User Added")

                  $('#group_detail_ul').append(
                  "<div class='member' style='margin-left:25%'> "+ member[0].first_name+" "+ member[0].last_name +" </div>"  
                  );
                }
                  
                  
                
              },
              error: function(){
                document.getElementById('error_message').innerHTML ="something went wrong"

              }
        }); 


})


function clearStyle(){
  var table = document.getElementsByClassName("menu-item");
    //or use :  var table = document.all.tableid;

    for( i = 0; i < table.length; i++)
    {
        table[i].style.backgroundColor = "#f3f3f3";
          table[i].style.color= "black";
    }
    

    dropdown = document.getElementsByClassName("faction_dropdown");
    for( i = 0; i < dropdown.length; i++)
    {
        dropdown[i].style.backgroundColor = "#f3f3f3";
          dropdown[i].style.color= "black";
    }
    document.getElementById('trashIcon').style.color= "grey";
    document.getElementById('allIcon').style.color= "grey";
    document.getElementById('recentlyAddedIcon').style.color= "grey";
    document.getElementById('recentlyReadIcon').style.color= "grey";
    document.getElementById('favoriteIcon').style.color= "grey";
    
}



function sort(n){
  // alert(n)
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById("itemTable");
  switching = true;
  // Set the sorting direction to ascending:
  dir = "asc";
  /* Make a loop that will continue until
  no switching has been done: */
  while (switching) {
    // Start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /* Loop through all table rows (except the
    first, which contains table headers): */
    for (i = 1; i < (rows.length - 1); i++) {
      // Start by saying there should be no switching:
      shouldSwitch = false;
      /* Get the two elements you want to compare,
      one from current row and one from the next: */
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      // alert(rows[i].getElementsByTagName("TD")[1].text)
      /* Check if the two rows should switch place,
      based on the direction, asc or desc: */
      if (dir == "asc") {
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          // If so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      } else if (dir == "desc") {
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          // If so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      }
    }
    if (shouldSwitch) {
      /* If a switch has been marked, make the switch
      and mark that a switch has been done: */
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      // Each time a switch is done, increase this count by 1:
      switchcount ++;
    } else {
      /* If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again. */
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}    



function getFolders(clicked_id, detail_id){
  action = "none"
  if(folders.length == 0 & groups.length == 0){
    action = "get_factions"

  }
  else if(folders.length == 0){
    action =  "get_folders"

  }
  else if(groups.length == 0){
    action = "get_groups"
  }
  else{
    bookmarkToFolder_dropdown(clicked_id, detail_id, folders, groups)
  }

  if(action != "none"){
      $.ajax({
        type:"POST",
        url:"",

        data:{
          action: action,
          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
        }, success: function(response){
        
          if(action == "get_factions"){
              folders = response.folders
              groups = response.groups
          } else if(action == "get_folders"){
              folders = response.list

          } else if(action == "get_groups"){
              groups = response.list

          } 
           bookmarkToFolder_dropdown(clicked_id, detail_id)

        }
      });  
  }
  

}
function bookmarkToFolder_dropdown(clicked_id, detail_id) {
  $("#add_to_folderList_ul"+clicked_id).empty();
      fold = folders
      grou = groups           
            if(fold.length >= 1){
              $('#add_to_folderList_ul'+clicked_id).append("<li style='padding-left:3%;'>Folders:</li>");

            for(i=0;i< fold.length;i++){
              
                $('#add_to_folderList_ul'+clicked_id).append(
                "<li id='folder"+fold[i].id+"' style='padding-left:20%; cursor:pointer' onclick='submit_add_folder(this.id,"+detail_id+")'>"+fold[i].name+"</li>");
              
              
            }
            $('#add_to_folderList_ul'+clicked_id).append("<br>");
            }

            if(grou.length >= 1){
             
              $('#add_to_folderList_ul'+clicked_id).append("<li style='padding-left:3%;'>Groups:</li>");
            for(i=0;i< grou.length;i++){
              
              
                $('#add_to_folderList_ul'+clicked_id).append(
                "<li id='groups"+grou[i].id+"' style='padding-left:20%; cursor:pointer' onclick='submit_add_folder(this.id,"+detail_id+")'>"+grou[i].name+"</li>");
                try{
                  if(grou[i].id == grou[i+1].id )
                    i++
                } catch{
                  
                }  
              
            }
            }
                
          
            
        
              
        

      
  document.getElementById("folderList_dropdown"+ clicked_id).classList.toggle("show");
  // alert(clicked_id)

}



function submit_add_folder(folder_id, bookmark_id){
  id = folder_id.slice(6,)
  faction =folder_id.slice(0,6)
  // tab

  $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        action: 'add_bookmark_to_faction',
                        b_id: bookmark_id,
                        faction_id: id,
                        faction: faction,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      }
  }); 
}
function add_folder_button() {
  document.getElementById("dropdown-content_input").classList.toggle("show");
}

function functionCollapse() {
  document.getElementById("folders").classList.toggle("show");
}



function display_dropdown(dropdown_type) {
        if(dropdown_type == 'folders' ){
            $("#mycollection_ul").empty();

            if(folders.length == 0){
                  $.ajax({
                        type:"POST",
                        url:"",

                        data:{
                          action: 'get_folders',
                          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                        }, success: function(response){
                           folders = response.list

                           for(i=0;i< folders.length;i++){
                          
                                 $('#mycollection_ul').append(
                                "<li id='folder"+folders[i].id+"' style='padding-left:20%;padding-bottom: 3%;padding-top: 3%; cursor:pointer' onclick='get_bookmarks(this.id)' class='faction_dropdown' oncontextmenu='delete_folder_rightClick(this.id, event)'>"+folders[i].name+"</li>"+
                                "<center><div id='folder"+folders[i].id+"_dropdown' class='dropdown-content' style='min-width: 50%; margin-left: 40%; cursor: pointer; margin-top: -8%; z-index:1 ' onclick='delete_faction(this.id,"+i+")'>"+
                               "<ul style='padding-top:7%;padding-bottom:7%'>"+
                                  "<div>delete</div>"+
                                    
                                "</ul> </div></center>");
                              
                          }
                        }
                  }); 
              } else{
                        for(i=0;i< folders.length;i++){
                          
                                 $('#mycollection_ul').append(
                                "<li id='folder"+folders[i].id+"' style='padding-left:20%;padding-bottom: 3%;padding-top: 3%; cursor:pointer' onclick='get_bookmarks(this.id)' class='faction_dropdown' oncontextmenu='delete_folder_rightClick(this.id, event)'>"+folders[i].name+"</li>"+
                                "<center><div id='folder"+folders[i].id+"_dropdown' class='dropdown-content' style='min-width: 50%; margin-left: 40%; cursor: pointer; margin-top: -8%; z-index:1 ' onclick='delete_faction(this.id,"+i+")'>"+
                               "<ul style='padding-top:7%;padding-bottom:7%'>"+
                                  "<div>delete</div>"+
                                    
                                "</ul> </div></center>");
                              
                          }
              }

                    
         
        } else if(dropdown_type == 'groups'){
          

              $("#mygroup_ul").empty();
              
              if(groups.length == 0){
                   $.ajax({
                        type:"POST",
                        url:"",

                        data:{
                          action: 'get_groups',
                          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                        }, success: function(response){
                            groups = response.list

                            for(i=0;i< groups.length;i++){
                   
                                   $('#mygroup_ul').append(
                                  "<li id='groups"+groups[i].id+"' style='padding-left:20%;padding-bottom: 3%;padding-top: 3%; cursor:pointer' onclick='get_bookmarks(this.id)' class='faction_dropdown' oncontextmenu='delete_folder_rightClick(this.id, event)'>"+groups[i].name+"</li>"+
                                  "<center><div id='groups"+groups[i].id+"_dropdown' class='dropdown-content' style='min-width: 50%; margin-left: 40%; cursor: pointer; margin-top: -8%; z-index:1' onclick='delete_faction(this.id,"+i+")'>"+
                                 "<ul style='padding-top:7%;padding-bottom:7%'>"+
                                    "<div>delete</div>"+
                                      
                                  "</ul> </div></center>");
                                try{
                                  if(groups[i].id == groups[i+1].id )
                                      i++
                                } catch{
                                  
                                } 
                            }
                        }
                  });

              } else{

                            for(i=0;i< groups.length;i++){
                   
                                   $('#mygroup_ul').append(
                                  "<li id='groups"+groups[i].id+"' style='padding-left:20%;padding-bottom: 3%;padding-top: 3%; cursor:pointer' onclick='get_bookmarks(this.id)' class='faction_dropdown' oncontextmenu='delete_folder_rightClick(this.id, event)'>"+groups[i].name+"</li>"+
                                  "<center><div id='groups"+groups[i].id+"_dropdown' class='dropdown-content' style='min-width: 50%; margin-left: 40%; cursor: pointer; margin-top: -8%; z-index:1' onclick='delete_faction(this.id,"+i+")'>"+
                                 "<ul style='padding-top:7%;padding-bottom:7%'>"+
                                    "<div>delete</div>"+
                                      
                                  "</ul> </div></center>");
                                try{
                                  if(groups[i].id == groups[i+1].id )
                                      i++
                                } catch{
                                  
                                } 
                            }
              }
                  
          } 

   
      
  
  
}
function delete_faction(clicked_id, i){
  faction = clicked_id.slice(0,6)
  if(faction == 'folder'){

        folder_id = clicked_id.replace('folder','').replace('_dropdown','')
                $.ajax({

                    type:"POST",
                    url:"",

                    data:{
                      action: 'delete_faction',
                      faction_type: faction,
                      id: folder_id,
                      
                      csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                    },
                }); 
        folders.splice(i,1)
        display_dropdown('folders')
  }
    
  else if(faction == 'groups'){
        folder_id = clicked_id.replace('groups','').replace('_dropdown','')
                $.ajax({

                    type:"POST",
                    url:"",

                    data:{
                      action: 'delete_faction',
                      faction_type: faction,
                      id: folder_id,
                      
                      csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                    },
                }); 
        groups.splice(i,1)
        display_dropdown('groups')
  }

}
function delete_folder_rightClick(clicked_id, event){
  event.preventDefault();
  document.getElementById(clicked_id +"_dropdown").classList.toggle("show");
}



function create_folder(create_type){

            if(create_type == 'folders'){
              fname = document.getElementById('foldername_input').value
                $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        action: 'add_folder',
                        name: fname,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      },

                      success: function(response){
                        createdFolder = response.createdFolder
                         if( response.did_exist == true){
                              document.getElementById("add_folder_error").style.visibility ="visible";
                         }else{
                                document.getElementById("dismiss-modal_folder").click()
                                
                                folders.push(createdFolder[0])
                                $('#mycollection_ul').append(
                                "<li id='folder"+createdFolder[0].id+"' style='padding-left:20%;padding-bottom: 3%;padding-top: 3%; cursor:pointer' onclick='get_bookmarks(this.id)' class='faction_dropdown' oncontextmenu='delete_folder_rightClick(this.id, event)'>"+createdFolder[0].name+"</li>"+
                                "<center><div id='folder"+createdFolder[0].id+"_dropdown' class='dropdown-content' style='min-width: 50%; margin-left: 40%; cursor: pointer; margin-top: -8%; z-index:1 ' onclick='delete_faction(this.id,"+i+")'>"+
                               "<ul style='padding-top:7%;padding-bottom:7%'>"+
                                  "<div>delete</div>"+
                                    
                                "</ul> </div></center>");
                         }

                      }
          
                }); 

            } else if(create_type == 'groups'){
              gname = document.getElementById('groupname_input').value
                $.ajax({

                          type:"POST",
                          url:"",

                          data:{
                            action: 'add_group',
                            name: gname,
                            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                          },

                          success: function(response){
                            createdFolder = response.createdGroup
                            if( response.did_exist == true){
                                  document.getElementById("add_group_error").style.visibility ="visible";
                            }else{
                                    document.getElementById("dismiss-modal_group").click()
                                    
                                    groups.push(createdFolder[0])
                                    $('#mygroups_ul').append(
                                    "<li id='groups"+createdFolder[0].id+"' style='padding-left:20%;padding-bottom: 3%;padding-top: 3%; cursor:pointer' onclick='get_bookmarks(this.id)' class='faction_dropdown' oncontextmenu='delete_folder_rightClick(this.id, event)'>"+createdFolder[0].name+"</li>"+
                                    "<center><div id='groups"+createdFolder[0].id+"_dropdown' class='dropdown-content' style='min-width: 50%; margin-left: 40%; cursor: pointer; margin-top: -8%; z-index:1 ' onclick='delete_faction(this.id,"+i+")'>"+
                                   "<ul style='padding-top:7%;padding-bottom:7%'>"+
                                      "<div>delete</div>"+
                                        
                                    "</ul> </div></center>");
                             }
                             
                        }

                      
                }); 
            }
  }







function hide_errorMessage(){
  document.getElementById('error_message').style.display="none"
  document.getElementById('add_folder_error').style.visibility="hidden"
  document.getElementById("add_group_error").style.visibility ="hidden";
                           
}


</script> 


</html>